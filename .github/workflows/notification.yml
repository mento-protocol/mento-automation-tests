name: Notification

on:
  workflow_call:
    inputs:
      JOB_STATUS:
        description: "Test job status"
        required: true
        type: string
      MESSAGE:
        description: "Notification message"
        required: true
        type: string
      JOB_URL:
        description: "Test job URL"
        required: true
        type: string
      REPORT_URL:
        description: "Playwright Report URL"
        required: false
        type: string

    secrets:
      DISCORD_TEST_RUN_WEBHOOK_ID:
        required: true
      DISCORD_TEST_RUN_WEBHOOK_TOKEN:
        required: true

jobs:
  notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: Send Notification
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: "https://discord.com/api/webhooks/${{ secrets.DISCORD_TEST_RUN_WEBHOOK_ID }}/${{ secrets.DISCORD_TEST_RUN_WEBHOOK_TOKEN }}"
          color: "${{ inputs.JOB_STATUS == 'success' && '#48f442' || '#ff0000' }}"
          username: "Test Run Notifier"
          message: "${{ inputs.JOB_STATUS == 'success' && '‚úÖ' || '‚ùå' }} ${{ inputs.MESSAGE }}\nüîó [Job](${{ inputs.JOB_URL }})\nüìä [Playwright Report](${{ inputs.REPORT_URL }})"
